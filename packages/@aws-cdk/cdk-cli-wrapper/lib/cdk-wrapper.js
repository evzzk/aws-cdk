"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CdkCliWrapper = void 0;
const commands_1 = require("./commands");
const utils_1 = require("./utils");
/**
 * Provides a programmatic interface for interacting with the CDK CLI by
 * wrapping the CLI with exec
 */
class CdkCliWrapper {
    constructor(options) {
        this.directory = options.directory;
        this.env = options.env;
        this.showOutput = options.showOutput ?? false;
        try {
            this.cdk = options.cdkExecutable ?? 'cdk';
        }
        catch {
            throw new Error(`could not resolve path to cdk executable: "${options.cdkExecutable ?? 'cdk'}"`);
        }
    }
    validateArgs(options) {
        if (!options.stacks && !options.all) {
            throw new Error('one of "app" or "stacks" must be provided');
        }
    }
    list(options) {
        const listCommandArgs = [
            ...renderBooleanArg('long', options.long),
            ...this.createDefaultArguments(options),
        ];
        return (0, utils_1.exec)([this.cdk, 'ls', ...listCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * cdk deploy
     */
    deploy(options) {
        const deployCommandArgs = [
            ...renderBooleanArg('ci', options.ci),
            ...renderBooleanArg('execute', options.execute),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('previous-parameters', options.usePreviousParameters),
            ...renderBooleanArg('rollback', options.rollback),
            ...renderBooleanArg('staging', options.staging),
            ...options.reuseAssets ? renderArrayArg('--reuse-assets', options.reuseAssets) : [],
            ...options.notificationArns ? renderArrayArg('--notification-arns', options.notificationArns) : [],
            ...options.parameters ? renderMapArrayArg('--parameters', options.parameters) : [],
            ...options.outputsFile ? ['--outputs-file', options.outputsFile] : [],
            ...options.requireApproval ? ['--require-approval', options.requireApproval] : [],
            ...options.changeSetName ? ['--change-set-name', options.changeSetName] : [],
            ...options.toolkitStackName ? ['--toolkit-stack-name', options.toolkitStackName] : [],
            ...options.progress ? ['--progress', options.progress] : ['--progress', commands_1.StackActivityProgress.EVENTS],
            ...options.deploymentMethod ? ['--method', options.deploymentMethod] : [],
            ...options.concurrency ? ['--concurrency', options.concurrency.toString()] : [],
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'deploy', ...deployCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    watch(options) {
        let hotswap;
        switch (options.hotswap) {
            case commands_1.HotswapMode.FALL_BACK:
                hotswap = '--hotswap-fallback';
                break;
            case commands_1.HotswapMode.HOTSWAP_ONLY:
                hotswap = '--hotswap';
                break;
            default:
                hotswap = '--hotswap-fallback';
                break;
        }
        const deployCommandArgs = [
            '--watch',
            ...renderBooleanArg('ci', options.ci),
            ...renderBooleanArg('execute', options.execute),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('previous-parameters', options.usePreviousParameters),
            ...renderBooleanArg('rollback', options.rollback),
            ...renderBooleanArg('staging', options.staging),
            ...renderBooleanArg('logs', options.traceLogs),
            hotswap,
            ...options.reuseAssets ? renderArrayArg('--reuse-assets', options.reuseAssets) : [],
            ...options.notificationArns ? renderArrayArg('--notification-arns', options.notificationArns) : [],
            ...options.parameters ? renderMapArrayArg('--parameters', options.parameters) : [],
            ...options.outputsFile ? ['--outputs-file', options.outputsFile] : [],
            ...options.requireApproval ? ['--require-approval', options.requireApproval] : [],
            ...options.changeSetName ? ['--change-set-name', options.changeSetName] : [],
            ...options.toolkitStackName ? ['--toolkit-stack-name', options.toolkitStackName] : [],
            ...options.progress ? ['--progress', options.progress] : ['--progress', commands_1.StackActivityProgress.EVENTS],
            ...options.deploymentMethod ? ['--method', options.deploymentMethod] : [],
            ...this.createDefaultArguments(options),
        ];
        return (0, utils_1.watch)([this.cdk, 'deploy', ...deployCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * cdk destroy
     */
    destroy(options) {
        const destroyCommandArgs = [
            ...renderBooleanArg('force', options.force),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'destroy', ...destroyCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * cdk synth
     */
    synth(options) {
        const synthCommandArgs = [
            ...renderBooleanArg('validation', options.validation),
            ...renderBooleanArg('quiet', options.quiet),
            ...renderBooleanArg('exclusively', options.exclusively),
            ...this.createDefaultArguments(options),
        ];
        (0, utils_1.exec)([this.cdk, 'synth', ...synthCommandArgs], {
            cwd: this.directory,
            verbose: this.showOutput,
            env: this.env,
        });
    }
    /**
     * Do a CDK synth, mimicking the CLI (without actually using it)
     *
     * The CLI has a pretty slow startup time because of all the modules it needs to load,
     * Bypass it to be quicker!
     */
    synthFast(options) {
        (0, utils_1.exec)(options.execCmd, {
            cwd: this.directory,
            verbose: this.showOutput,
            env: {
                CDK_CONTEXT_JSON: JSON.stringify(options.context),
                CDK_OUTDIR: options.output,
                ...this.env,
                ...options.env,
            },
        });
    }
    createDefaultArguments(options) {
        this.validateArgs(options);
        const stacks = options.stacks ?? [];
        return [
            ...options.app ? ['--app', options.app] : [],
            ...renderBooleanArg('strict', options.strict),
            ...renderBooleanArg('trace', options.trace),
            ...renderBooleanArg('lookups', options.lookups),
            ...renderBooleanArg('ignore-errors', options.ignoreErrors),
            ...renderBooleanArg('json', options.json),
            ...renderBooleanArg('verbose', options.verbose),
            ...renderBooleanArg('debug', options.debug),
            ...renderBooleanArg('ec2creds', options.ec2Creds),
            ...renderBooleanArg('version-reporting', options.versionReporting),
            ...renderBooleanArg('path-metadata', options.pathMetadata),
            ...renderBooleanArg('asset-metadata', options.assetMetadata),
            ...renderBooleanArg('notices', options.notices),
            ...renderBooleanArg('color', options.color),
            ...options.context ? renderMapArrayArg('--context', options.context) : [],
            ...options.profile ? ['--profile', options.profile] : [],
            ...options.proxy ? ['--proxy', options.proxy] : [],
            ...options.caBundlePath ? ['--ca-bundle-path', options.caBundlePath] : [],
            ...options.roleArn ? ['--role-arn', options.roleArn] : [],
            ...options.output ? ['--output', options.output] : [],
            ...stacks,
            ...options.all ? ['--all'] : [],
        ];
    }
}
exports.CdkCliWrapper = CdkCliWrapper;
function renderMapArrayArg(flag, parameters) {
    const params = [];
    for (const [key, value] of Object.entries(parameters)) {
        params.push(`${key}=${value}`);
    }
    return renderArrayArg(flag, params);
}
function renderArrayArg(flag, values) {
    let args = [];
    for (const value of values ?? []) {
        args.push(flag, value);
    }
    return args;
}
function renderBooleanArg(val, arg) {
    if (arg) {
        return [`--${val}`];
    }
    else if (arg === undefined) {
        return [];
    }
    else {
        return [`--no-${val}`];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLXdyYXBwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjZGstd3JhcHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSx5Q0FBNkk7QUFDN0ksbUNBQXNDO0FBMkh0Qzs7O0dBR0c7QUFDSCxNQUFhLGFBQWE7SUFNeEIsWUFBWSxPQUE2QjtRQUN2QyxJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUM7UUFDbkMsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLFVBQVUsSUFBSSxLQUFLLENBQUM7UUFDOUMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQztRQUM1QyxDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsT0FBTyxDQUFDLGFBQWEsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ25HLENBQUM7SUFDSCxDQUFDO0lBRU8sWUFBWSxDQUFDLE9BQTBCO1FBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkNBQTJDLENBQUMsQ0FBQztRQUMvRCxDQUFDO0lBQ0gsQ0FBQztJQUVNLElBQUksQ0FBQyxPQUFvQjtRQUM5QixNQUFNLGVBQWUsR0FBYTtZQUNoQyxHQUFHLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ3pDLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sQ0FBQztTQUN4QyxDQUFDO1FBRUYsT0FBTyxJQUFBLFlBQUksRUFBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsZUFBZSxDQUFDLEVBQUU7WUFD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QixDQUFDO1NBQU0sSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDN0IsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO1NBQU0sQ0FBQztRQUNOLE9BQU8sQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekIsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGlsZFByb2Nlc3MgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IERlZmF1bHRDZGtPcHRpb25zLCBEZXBsb3lPcHRpb25zLCBEZXN0cm95T3B0aW9ucywgU3ludGhPcHRpb25zLCBMaXN0T3B0aW9ucywgU3RhY2tBY3Rpdml0eVByb2dyZXNzLCBIb3Rzd2FwTW9kZSB9IGZyb20gJy4vY29tbWFuZHMnO1xuaW1wb3J0IHsgZXhlYywgd2F0Y2ggfSBmcm9tICcuL3V0aWxzJztcblxuLyoqXG4gKiBBV1MgQ0RLIENMSSBvcGVyYXRpb25zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUNkayB7XG5cbiAgLyoqXG4gICAqIGNkayBkZXBsb3lcbiAgICovXG4gIGRlcGxveShvcHRpb25zOiBEZXBsb3lPcHRpb25zKTogdm9pZDtcblxuICAvKipcbiAgICogY2RrIHN5bnRoXG4gICAqL1xuICBzeW50aChvcHRpb25zOiBTeW50aE9wdGlvbnMpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBjZGsgZGVzdHJveVxuICAgKi9cbiAgZGVzdHJveShvcHRpb25zOiBEZXN0cm95T3B0aW9ucyk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIGNkayBsaXN0XG4gICAqL1xuICBsaXN0KG9wdGlvbnM6IExpc3RPcHRpb25zKTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBjZGsgc3ludGggZmFzdFxuICAgKi9cbiAgc3ludGhGYXN0KG9wdGlvbnM6IFN5bnRoRmFzdE9wdGlvbnMpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBjZGsgd2F0Y2hcbiAgICovXG4gIHdhdGNoKG9wdGlvbnM6IERlcGxveU9wdGlvbnMpOiBDaGlsZFByb2Nlc3M7XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3Igc3ludGhpbmcgYW5kIGJ5cGFzc2luZyB0aGUgQ0RLIENMSVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFN5bnRoRmFzdE9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIGNvbW1hbmQgdG8gdXNlIHRvIGV4ZWN1dGUgdGhlIGFwcC5cbiAgICogVGhpcyBpcyB0eXBpY2FsbHkgdGhlIHNhbWUgdGhpbmcgdGhhdCBub3JtYWxseVxuICAgKiBnZXRzIHBhc3NlZCB0byBgLS1hcHBgXG4gICAqXG4gICAqIGUuZy4gXCJub2RlICdiaW4vbXktYXBwLnRzJ1wiXG4gICAqIG9yICdnbyBydW4gbWFpbi5nbydcbiAgICovXG4gIHJlYWRvbmx5IGV4ZWNDbWQ6IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUgc3ludGhlc2l6ZWQgY2xvdWQgYXNzZW1ibHkgaW50byBhIGRpcmVjdG9yeVxuICAgKlxuICAgKiBAZGVmYXVsdCBjZGsub3V0XG4gICAqL1xuICByZWFkb25seSBvdXRwdXQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgY29udGV4dFxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgY29udGV4dFxuICAgKi9cbiAgcmVhZG9ubHkgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldCBpbiB0aGVcbiAgICogZXhlY3V0aW9uIGVudmlyb25tZW50XG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBlbnZcbiAgICovXG4gIHJlYWRvbmx5IGVudj86IHsgW25hbWU6IHN0cmluZ106IHN0cmluZyB9O1xufVxuXG4vKipcbiAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldCBpbiB0aGUgZXhlY3V0aW9uIGVudmlyb25tZW50XG4gKlxuICogQGRlcHJlY2F0ZWQgVXNlIHJhdyBwcm9wZXJ0eSBiYWdzIGluc3RlYWQgKG9iamVjdCBsaXRlcmFscywgYE1hcDxTdHJpbmcsT2JqZWN0PmAsIGV0Yy4uLiApXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRW52aXJvbm1lbnQge1xuICAvKipcbiAgICogVGhpcyBpbmRleCBzaWduYXR1cmUgaXMgbm90IHVzYWJsZSBpbiBub24tVHlwZVNjcmlwdC9KYXZhU2NyaXB0IGxhbmd1YWdlcy5cbiAgICpcbiAgICogQGpzaWkgaWdub3JlXG4gICAqL1xuICBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogQVdTIENESyBjbGllbnQgdGhhdCBwcm92aWRlcyBhbiBBUEkgdG8gcHJvZ3JhbWF0aWNhbGx5IGV4ZWN1dGUgdGhlIENESyBDTElcbiAqIGJ5IHdyYXBwaW5nIGNhbGxzIHRvIGV4ZWMgdGhlIENMSVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENka0NsaVdyYXBwZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIFRoZSBkaXJlY3RvcnkgdG8gcnVuIHRoZSBjZGsgY29tbWFuZHMgZnJvbVxuICAgKi9cbiAgcmVhZG9ubHkgZGlyZWN0b3J5OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgZW52aXJvbm1lbnQgdmFyaWFibGVzIHRvIHNldFxuICAgKiBpbiB0aGUgZXhlY3V0aW9uIGVudmlyb25tZW50IHRoYXQgd2lsbCBiZSBydW5uaW5nXG4gICAqIHRoZSBjZGsgY29tbWFuZHNcbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBhZGRpdGlvbmFsIGVudiB2YXJzXG4gICAqL1xuICByZWFkb25seSBlbnY/OiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfTtcblxuICAvKipcbiAgICogVGhlIHBhdGggdG8gdGhlIGNkayBleGVjdXRhYmxlXG4gICAqXG4gICAqIEBkZWZhdWx0ICdhd3MtY2RrL2Jpbi9jZGsnXG4gICAqL1xuICByZWFkb25seSBjZGtFeGVjdXRhYmxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTaG93IHRoZSBvdXRwdXQgZnJvbSBydW5uaW5nIHRoZSBDREsgQ0xJXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzaG93T3V0cHV0PzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIHByb2dyYW1tYXRpYyBpbnRlcmZhY2UgZm9yIGludGVyYWN0aW5nIHdpdGggdGhlIENESyBDTEkgYnlcbiAqIHdyYXBwaW5nIHRoZSBDTEkgd2l0aCBleGVjXG4gKi9cbmV4cG9ydCBjbGFzcyBDZGtDbGlXcmFwcGVyIGltcGxlbWVudHMgSUNkayB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGlyZWN0b3J5OiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW52PzogeyBbbmFtZTogc3RyaW5nXTogc3RyaW5nIHwgdW5kZWZpbmVkIH07XG4gIHByaXZhdGUgcmVhZG9ubHkgY2RrOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2hvd091dHB1dDogYm9vbGVhbjtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBDZGtDbGlXcmFwcGVyT3B0aW9ucykge1xuICAgIHRoaXMuZGlyZWN0b3J5ID0gb3B0aW9ucy5kaXJlY3Rvcnk7XG4gICAgdGhpcy5lbnYgPSBvcHRpb25zLmVudjtcbiAgICB0aGlzLnNob3dPdXRwdXQgPSBvcHRpb25zLnNob3dPdXRwdXQgPz8gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuY2RrID0gb3B0aW9ucy5jZGtFeGVjdXRhYmxlID8/ICdjZGsnO1xuICAgIH0gY2F0Y2gge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBjb3VsZCBub3QgcmVzb2x2ZSBwYXRoIHRvIGNkayBleGVjdXRhYmxlOiBcIiR7b3B0aW9ucy5jZGtFeGVjdXRhYmxlID8/ICdjZGsnfVwiYCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZUFyZ3Mob3B0aW9uczogRGVmYXVsdENka09wdGlvbnMpOiB2b2lkIHtcbiAgICBpZiAoIW9wdGlvbnMuc3RhY2tzICYmICFvcHRpb25zLmFsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdvbmUgb2YgXCJhcHBcIiBvciBcInN0YWNrc1wiIG11c3QgYmUgcHJvdmlkZWQnKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbGlzdChvcHRpb25zOiBMaXN0T3B0aW9ucyk6IHN0cmluZyB7XG4gICAgY29uc3QgbGlzdENvbW1hbmRBcmdzOiBzdHJpbmdbXSA9IFtcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2xvbmcnLCBvcHRpb25zLmxvbmcpLFxuICAgICAgLi4udGhpcy5jcmVhdGVEZWZhdWx0QXJndW1lbnRzKG9wdGlvbnMpLFxuICAgIF07XG5cbiAgICByZXR1cm4gZXhlYyhbdGhpcy5jZGssICdscycsIC4uLmxpc3RDb21tYW5kQXJnc10sIHtcbiAgICAgIGN3ZDogdGhpcy5kaXJlY3RvcnksXG4gICAgICB2ZXJib3NlOiB0aGlzLnNob3dPdXRwdXQsXG4gICAgICBlbnY6IHRoaXMuZW52LFxuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiBjZGsgZGVwbG95XG4gICAqL1xuICBwdWJsaWMgZGVwbG95KG9wdGlvbnM6IERlcGxveU9wdGlvbnMpOiB2b2lkIHtcbiAgICBjb25zdCBkZXBsb3lDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdjaScsIG9wdGlvbnMuY2kpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZXhlY3V0ZScsIG9wdGlvbnMuZXhlY3V0ZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZm9yY2UnLCBvcHRpb25zLmZvcmNlKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ByZXZpb3VzLXBhcmFtZXRlcnMnLCBvcHRpb25zLnVzZVByZXZpb3VzUGFyYW1ldGVycyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdyb2xsYmFjaycsIG9wdGlvbnMucm9sbGJhY2spLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnc3RhZ2luZycsIG9wdGlvbnMuc3RhZ2luZyksXG4gICAgICAuLi5vcHRpb25zLnJldXNlQXNzZXRzID8gcmVuZGVyQXJyYXlBcmcoJy0tcmV1c2UtYXNzZXRzJywgb3B0aW9ucy5yZXVzZUFzc2V0cykgOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMubm90aWZpY2F0aW9uQXJucyA/IHJlbmRlckFycmF5QXJnKCctLW5vdGlmaWNhdGlvbi1hcm5zJywgb3B0aW9ucy5ub3RpZmljYXRpb25Bcm5zKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5wYXJhbWV0ZXJzID8gcmVuZGVyTWFwQXJyYXlBcmcoJy0tcGFyYW1ldGVycycsIG9wdGlvbnMucGFyYW1ldGVycykgOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMub3V0cHV0c0ZpbGUgPyBbJy0tb3V0cHV0cy1maWxlJywgb3B0aW9ucy5vdXRwdXRzRmlsZV0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMucmVxdWlyZUFwcHJvdmFsID8gWyctLXJlcXVpcmUtYXBwcm92YWwnLCBvcHRpb25zLnJlcXVpcmVBcHByb3ZhbF0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMuY2hhbmdlU2V0TmFtZSA/IFsnLS1jaGFuZ2Utc2V0LW5hbWUnLCBvcHRpb25zLmNoYW5nZVNldE5hbWVdIDogW10sXG4gICAgICAuLi5vcHRpb25zLnRvb2xraXRTdGFja05hbWUgPyBbJy0tdG9vbGtpdC1zdGFjay1uYW1lJywgb3B0aW9ucy50b29sa2l0U3RhY2tOYW1lXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5wcm9ncmVzcyA/IFsnLS1wcm9ncmVzcycsIG9wdGlvbnMucHJvZ3Jlc3NdIDogWyctLXByb2dyZXNzJywgU3RhY2tBY3Rpdml0eVByb2dyZXNzLkVWRU5UU10sXG4gICAgICAuLi5vcHRpb25zLmRlcGxveW1lbnRNZXRob2QgPyBbJy0tbWV0aG9kJywgb3B0aW9ucy5kZXBsb3ltZW50TWV0aG9kXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5jb25jdXJyZW5jeSA/IFsnLS1jb25jdXJyZW5jeScsIG9wdGlvbnMuY29uY3VycmVuY3kudG9TdHJpbmcoKV0gOiBbXSxcbiAgICAgIC4uLnRoaXMuY3JlYXRlRGVmYXVsdEFyZ3VtZW50cyhvcHRpb25zKSxcbiAgICBdO1xuXG4gICAgZXhlYyhbdGhpcy5jZGssICdkZXBsb3knLCAuLi5kZXBsb3lDb21tYW5kQXJnc10sIHtcbiAgICAgIGN3ZDogdGhpcy5kaXJlY3RvcnksXG4gICAgICB2ZXJib3NlOiB0aGlzLnNob3dPdXRwdXQsXG4gICAgICBlbnY6IHRoaXMuZW52LFxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHdhdGNoKG9wdGlvbnM6IERlcGxveU9wdGlvbnMpOiBDaGlsZFByb2Nlc3Mge1xuICAgIGxldCBob3Rzd2FwOiBzdHJpbmc7XG4gICAgc3dpdGNoIChvcHRpb25zLmhvdHN3YXApIHtcbiAgICAgIGNhc2UgSG90c3dhcE1vZGUuRkFMTF9CQUNLOlxuICAgICAgICBob3Rzd2FwID0gJy0taG90c3dhcC1mYWxsYmFjayc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBIb3Rzd2FwTW9kZS5IT1RTV0FQX09OTFk6XG4gICAgICAgIGhvdHN3YXAgPSAnLS1ob3Rzd2FwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBob3Rzd2FwID0gJy0taG90c3dhcC1mYWxsYmFjayc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjb25zdCBkZXBsb3lDb21tYW5kQXJnczogc3RyaW5nW10gPSBbXG4gICAgICAnLS13YXRjaCcsXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdjaScsIG9wdGlvbnMuY2kpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZXhlY3V0ZScsIG9wdGlvbnMuZXhlY3V0ZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZm9yY2UnLCBvcHRpb25zLmZvcmNlKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ByZXZpb3VzLXBhcmFtZXRlcnMnLCBvcHRpb25zLnVzZVByZXZpb3VzUGFyYW1ldGVycyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdyb2xsYmFjaycsIG9wdGlvbnMucm9sbGJhY2spLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnc3RhZ2luZycsIG9wdGlvbnMuc3RhZ2luZyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdsb2dzJywgb3B0aW9ucy50cmFjZUxvZ3MpLFxuICAgICAgaG90c3dhcCxcbiAgICAgIC4uLm9wdGlvbnMucmV1c2VBc3NldHMgPyByZW5kZXJBcnJheUFyZygnLS1yZXVzZS1hc3NldHMnLCBvcHRpb25zLnJldXNlQXNzZXRzKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5ub3RpZmljYXRpb25Bcm5zID8gcmVuZGVyQXJyYXlBcmcoJy0tbm90aWZpY2F0aW9uLWFybnMnLCBvcHRpb25zLm5vdGlmaWNhdGlvbkFybnMpIDogW10sXG4gICAgICAuLi5vcHRpb25zLnBhcmFtZXRlcnMgPyByZW5kZXJNYXBBcnJheUFyZygnLS1wYXJhbWV0ZXJzJywgb3B0aW9ucy5wYXJhbWV0ZXJzKSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5vdXRwdXRzRmlsZSA/IFsnLS1vdXRwdXRzLWZpbGUnLCBvcHRpb25zLm91dHB1dHNGaWxlXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5yZXF1aXJlQXBwcm92YWwgPyBbJy0tcmVxdWlyZS1hcHByb3ZhbCcsIG9wdGlvbnMucmVxdWlyZUFwcHJvdmFsXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5jaGFuZ2VTZXROYW1lID8gWyctLWNoYW5nZS1zZXQtbmFtZScsIG9wdGlvbnMuY2hhbmdlU2V0TmFtZV0gOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMudG9vbGtpdFN0YWNrTmFtZSA/IFsnLS10b29sa2l0LXN0YWNrLW5hbWUnLCBvcHRpb25zLnRvb2xraXRTdGFja05hbWVdIDogW10sXG4gICAgICAuLi5vcHRpb25zLnByb2dyZXNzID8gWyctLXByb2dyZXNzJywgb3B0aW9ucy5wcm9ncmVzc10gOiBbJy0tcHJvZ3Jlc3MnLCBTdGFja0FjdGl2aXR5UHJvZ3Jlc3MuRVZFTlRTXSxcbiAgICAgIC4uLm9wdGlvbnMuZGVwbG95bWVudE1ldGhvZCA/IFsnLS1tZXRob2QnLCBvcHRpb25zLmRlcGxveW1lbnRNZXRob2RdIDogW10sXG4gICAgICAuLi50aGlzLmNyZWF0ZURlZmF1bHRBcmd1bWVudHMob3B0aW9ucyksXG4gICAgXTtcblxuICAgIHJldHVybiB3YXRjaChbdGhpcy5jZGssICdkZXBsb3knLCAuLi5kZXBsb3lDb21tYW5kQXJnc10sIHtcbiAgICAgIGN3ZDogdGhpcy5kaXJlY3RvcnksXG4gICAgICB2ZXJib3NlOiB0aGlzLnNob3dPdXRwdXQsXG4gICAgICBlbnY6IHRoaXMuZW52LFxuICAgIH0pO1xuXG4gIH1cblxuICAvKipcbiAgICogY2RrIGRlc3Ryb3lcbiAgICovXG4gIHB1YmxpYyBkZXN0cm95KG9wdGlvbnM6IERlc3Ryb3lPcHRpb25zKTogdm9pZCB7XG4gICAgY29uc3QgZGVzdHJveUNvbW1hbmRBcmdzOiBzdHJpbmdbXSA9IFtcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2ZvcmNlJywgb3B0aW9ucy5mb3JjZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdleGNsdXNpdmVseScsIG9wdGlvbnMuZXhjbHVzaXZlbHkpLFxuICAgICAgLi4udGhpcy5jcmVhdGVEZWZhdWx0QXJndW1lbnRzKG9wdGlvbnMpLFxuICAgIF07XG5cbiAgICBleGVjKFt0aGlzLmNkaywgJ2Rlc3Ryb3knLCAuLi5kZXN0cm95Q29tbWFuZEFyZ3NdLCB7XG4gICAgICBjd2Q6IHRoaXMuZGlyZWN0b3J5LFxuICAgICAgdmVyYm9zZTogdGhpcy5zaG93T3V0cHV0LFxuICAgICAgZW52OiB0aGlzLmVudixcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjZGsgc3ludGhcbiAgICovXG4gIHB1YmxpYyBzeW50aChvcHRpb25zOiBTeW50aE9wdGlvbnMpOiB2b2lkIHtcbiAgICBjb25zdCBzeW50aENvbW1hbmRBcmdzOiBzdHJpbmdbXSA9IFtcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ZhbGlkYXRpb24nLCBvcHRpb25zLnZhbGlkYXRpb24pLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygncXVpZXQnLCBvcHRpb25zLnF1aWV0KSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2V4Y2x1c2l2ZWx5Jywgb3B0aW9ucy5leGNsdXNpdmVseSksXG4gICAgICAuLi50aGlzLmNyZWF0ZURlZmF1bHRBcmd1bWVudHMob3B0aW9ucyksXG4gICAgXTtcblxuICAgIGV4ZWMoW3RoaXMuY2RrLCAnc3ludGgnLCAuLi5zeW50aENvbW1hbmRBcmdzXSwge1xuICAgICAgY3dkOiB0aGlzLmRpcmVjdG9yeSxcbiAgICAgIHZlcmJvc2U6IHRoaXMuc2hvd091dHB1dCxcbiAgICAgIGVudjogdGhpcy5lbnYsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRG8gYSBDREsgc3ludGgsIG1pbWlja2luZyB0aGUgQ0xJICh3aXRob3V0IGFjdHVhbGx5IHVzaW5nIGl0KVxuICAgKlxuICAgKiBUaGUgQ0xJIGhhcyBhIHByZXR0eSBzbG93IHN0YXJ0dXAgdGltZSBiZWNhdXNlIG9mIGFsbCB0aGUgbW9kdWxlcyBpdCBuZWVkcyB0byBsb2FkLFxuICAgKiBCeXBhc3MgaXQgdG8gYmUgcXVpY2tlciFcbiAgICovXG4gIHB1YmxpYyBzeW50aEZhc3Qob3B0aW9uczogU3ludGhGYXN0T3B0aW9ucyk6IHZvaWQge1xuICAgIGV4ZWMob3B0aW9ucy5leGVjQ21kLCB7XG4gICAgICBjd2Q6IHRoaXMuZGlyZWN0b3J5LFxuICAgICAgdmVyYm9zZTogdGhpcy5zaG93T3V0cHV0LFxuICAgICAgZW52OiB7XG4gICAgICAgIENES19DT05URVhUX0pTT046IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMuY29udGV4dCksXG4gICAgICAgIENES19PVVRESVI6IG9wdGlvbnMub3V0cHV0LFxuICAgICAgICAuLi50aGlzLmVudixcbiAgICAgICAgLi4ub3B0aW9ucy5lbnYsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVEZWZhdWx0QXJndW1lbnRzKG9wdGlvbnM6IERlZmF1bHRDZGtPcHRpb25zKTogc3RyaW5nW10ge1xuICAgIHRoaXMudmFsaWRhdGVBcmdzKG9wdGlvbnMpO1xuICAgIGNvbnN0IHN0YWNrcyA9IG9wdGlvbnMuc3RhY2tzID8/IFtdO1xuICAgIHJldHVybiBbXG4gICAgICAuLi5vcHRpb25zLmFwcCA/IFsnLS1hcHAnLCBvcHRpb25zLmFwcF0gOiBbXSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3N0cmljdCcsIG9wdGlvbnMuc3RyaWN0KSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3RyYWNlJywgb3B0aW9ucy50cmFjZSksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdsb29rdXBzJywgb3B0aW9ucy5sb29rdXBzKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2lnbm9yZS1lcnJvcnMnLCBvcHRpb25zLmlnbm9yZUVycm9ycyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdqc29uJywgb3B0aW9ucy5qc29uKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ3ZlcmJvc2UnLCBvcHRpb25zLnZlcmJvc2UpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnZGVidWcnLCBvcHRpb25zLmRlYnVnKSxcbiAgICAgIC4uLnJlbmRlckJvb2xlYW5BcmcoJ2VjMmNyZWRzJywgb3B0aW9ucy5lYzJDcmVkcyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCd2ZXJzaW9uLXJlcG9ydGluZycsIG9wdGlvbnMudmVyc2lvblJlcG9ydGluZyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdwYXRoLW1ldGFkYXRhJywgb3B0aW9ucy5wYXRoTWV0YWRhdGEpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnYXNzZXQtbWV0YWRhdGEnLCBvcHRpb25zLmFzc2V0TWV0YWRhdGEpLFxuICAgICAgLi4ucmVuZGVyQm9vbGVhbkFyZygnbm90aWNlcycsIG9wdGlvbnMubm90aWNlcyksXG4gICAgICAuLi5yZW5kZXJCb29sZWFuQXJnKCdjb2xvcicsIG9wdGlvbnMuY29sb3IpLFxuICAgICAgLi4ub3B0aW9ucy5jb250ZXh0ID8gcmVuZGVyTWFwQXJyYXlBcmcoJy0tY29udGV4dCcsIG9wdGlvbnMuY29udGV4dCkgOiBbXSxcbiAgICAgIC4uLm9wdGlvbnMucHJvZmlsZSA/IFsnLS1wcm9maWxlJywgb3B0aW9ucy5wcm9maWxlXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5wcm94eSA/IFsnLS1wcm94eScsIG9wdGlvbnMucHJveHldIDogW10sXG4gICAgICAuLi5vcHRpb25zLmNhQnVuZGxlUGF0aCA/IFsnLS1jYS1idW5kbGUtcGF0aCcsIG9wdGlvbnMuY2FCdW5kbGVQYXRoXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5yb2xlQXJuID8gWyctLXJvbGUtYXJuJywgb3B0aW9ucy5yb2xlQXJuXSA6IFtdLFxuICAgICAgLi4ub3B0aW9ucy5vdXRwdXQgPyBbJy0tb3V0cHV0Jywgb3B0aW9ucy5vdXRwdXRdIDogW10sXG4gICAgICAuLi5zdGFja3MsXG4gICAgICAuLi5vcHRpb25zLmFsbCA/IFsnLS1hbGwnXSA6IFtdLFxuICAgIF07XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVuZGVyTWFwQXJyYXlBcmcoZmxhZzogc3RyaW5nLCBwYXJhbWV0ZXJzOiB7IFtuYW1lOiBzdHJpbmddOiBzdHJpbmcgfCB1bmRlZmluZWQgfSk6IHN0cmluZ1tdIHtcbiAgY29uc3QgcGFyYW1zOiBzdHJpbmdbXSA9IFtdO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwYXJhbWV0ZXJzKSkge1xuICAgIHBhcmFtcy5wdXNoKGAke2tleX09JHt2YWx1ZX1gKTtcbiAgfVxuICByZXR1cm4gcmVuZGVyQXJyYXlBcmcoZmxhZywgcGFyYW1zKTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyQXJyYXlBcmcoZmxhZzogc3RyaW5nLCB2YWx1ZXM/OiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgbGV0IGFyZ3M6IHN0cmluZ1tdID0gW107XG4gIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzID8/IFtdKSB7XG4gICAgYXJncy5wdXNoKGZsYWcsIHZhbHVlKTtcbiAgfVxuICByZXR1cm4gYXJncztcbn1cblxuZnVuY3Rpb24gcmVuZGVyQm9vbGVhbkFyZyh2YWw6IHN0cmluZywgYXJnPzogYm9vbGVhbik6IHN0cmluZ1tdIHtcbiAgaWYgKGFyZykge1xuICAgIHJldHVybiBbYC0tJHt2YWx9YF07XG4gIH0gZWxzZSBpZiAoYXJnID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gW107XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFtgLS1uby0ke3ZhbH1gXTtcbiAgfVxufVxuIl19