"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MockCdkProvider = void 0;
const stream_1 = require("stream");
const cdk_cli_wrapper_1 = require("@aws-cdk/cdk-cli-wrapper");
const runner_1 = require("../lib/runner");
class MockCdkProvider {
    constructor(options) {
        this.mocks = {};
        this.cdk = new cdk_cli_wrapper_1.CdkCliWrapper(options);
    }
    mockDeploy(mock) {
        this.mocks.deploy = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation();
        this.cdk.deploy = this.mocks.deploy;
    }
    mockWatch(mock) {
        this.mocks.watch = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation(jest.fn(() => {
            return {
                on: (_event, listener) => {
                    listener(0);
                },
                stdout: new stream_1.Readable({ read: jest.fn(() => { }) }),
                stderr: new stream_1.Readable({ read: jest.fn(() => { }) }),
                stdin: new stream_1.Writable({ write: jest.fn(() => { }), final: jest.fn(() => { }) }),
            };
        }));
        this.cdk.watch = this.mocks.watch;
    }
    mockSynth(mock) {
        this.mocks.synth = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation();
        this.cdk.synth = this.mocks.synth;
    }
    mockSynthFast(mock) {
        this.mocks.synthFast = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation();
        this.cdk.synthFast = this.mocks.synthFast;
    }
    mockDestroy(mock) {
        this.mocks.destroy = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation();
        this.cdk.destroy = this.mocks.destroy;
    }
    mockList(mock) {
        this.mocks.list = mock !== null && mock !== void 0 ? mock : jest.fn().mockImplementation();
        this.cdk.list = this.mocks.list;
    }
    mockAll(mocks = {}) {
        this.mockDeploy(mocks.deploy);
        this.mockWatch(mocks.watch);
        this.mockSynth(mocks.synth);
        this.mockSynthFast(mocks.synthFast);
        this.mockDestroy(mocks.destroy);
        this.mockList(mocks.list);
        return this.mocks;
    }
    /**
     * Run a test of the testSnapshot method
     * @param integTestFile This name is used to determined the expected (committed) snapshot
     * @param actualSnapshot The directory of the snapshot that is used for of the actual (current) app
     * @returns Diagnostics as they would be returned by testSnapshot
     */
    snapshotTest(integTestFile, actualSnapshot) {
        // WHEN
        const integTest = new runner_1.IntegSnapshotRunner({
            cdk: this.cdk,
            test: new runner_1.IntegTest({
                fileName: 'test/test-data/' + integTestFile,
                discoveryRoot: 'test/test-data',
            }),
            integOutDir: actualSnapshot ? 'test/test-data/' + actualSnapshot : undefined,
        });
        integTest.actualTests();
        const results = integTest.testSnapshot();
        // THEN
        expect(this.mocks.synthFast).toHaveBeenCalledTimes(2);
        expect(this.mocks.synthFast).toHaveBeenCalledWith({
            env: expect.objectContaining({
                CDK_INTEG_ACCOUNT: '12345678',
                CDK_INTEG_REGION: 'test-region',
            }),
            execCmd: ['node', integTestFile],
            output: actualSnapshot !== null && actualSnapshot !== void 0 ? actualSnapshot : `cdk-integ.out.${integTestFile}.snapshot`,
        });
        return results;
    }
}
exports.MockCdkProvider = MockCdkProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsbUNBQTRDO0FBQzVDLDhEQUFpSztBQUNqSywwQ0FBK0Q7QUFZL0QsTUFBYSxlQUFlO0lBSTFCLFlBQVksT0FBNkI7UUFGekIsVUFBSyxHQUFpQixFQUFFLENBQUM7UUFHdkMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLCtCQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVNLFVBQVUsQ0FBQyxJQUE2QjtRQUM3QyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxJQUFJLGFBQUosSUFBSSxjQUFKLElBQUksR0FBSSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUMzRCxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUN0QyxDQUFDO0lBQ00sU0FBUyxDQUFDLElBQTRCO1FBQzNDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksYUFBSixJQUFJLGNBQUosSUFBSSxHQUFJLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtZQUNuRSxPQUFPO2dCQUNMLEVBQUUsRUFBRSxDQUFDLE1BQWUsRUFBRSxRQUFtQyxFQUFFLEVBQUU7b0JBQzNELFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDZCxDQUFDO2dCQUNELE1BQU0sRUFBRSxJQUFJLGlCQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRSxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNqRCxNQUFNLEVBQUUsSUFBSSxpQkFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FB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QUFTO1NBQzdFLENBQUMsQ0FBQztRQUNILFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QixNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFekMsT0FBTztRQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO1lBQ2hELEdBQUcsRUFBRSxNQUFNLENBQUMsZ0JBQWdCLENBQUM7Z0JBQzNCLGlCQUFpQixFQUFFLFVBQVU7Z0JBQzdCLGdCQUFnQixFQUFFLGFBQWE7YUFDaEMsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUM7WUFDaEMsTUFBTSxFQUFFLGNBQWMsYUFBZCxjQUFjLGNBQWQsY0FBYyxHQUFJLGlCQUFpQixhQUFhLFdBQVc7U0FDcEUsQ0FBQyxDQUFDO1FBRUgsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztDQUNGO0FBdkZELDBDQXVGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoaWxkUHJvY2VzcyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgUmVhZGFibGUsIFdyaXRhYmxlIH0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IENka0NsaVdyYXBwZXIsIENka0NsaVdyYXBwZXJPcHRpb25zLCBEZXBsb3lPcHRpb25zLCBEZXN0cm95T3B0aW9ucywgSUNkaywgTGlzdE9wdGlvbnMsIFN5bnRoRmFzdE9wdGlvbnMsIFN5bnRoT3B0aW9ucyB9IGZyb20gJ0Bhd3MtY2RrL2Nkay1jbGktd3JhcHBlcic7XG5pbXBvcnQgeyBJbnRlZ1NuYXBzaG90UnVubmVyLCBJbnRlZ1Rlc3QgfSBmcm9tICcuLi9saWIvcnVubmVyJztcbmltcG9ydCB7IERlc3RydWN0aXZlQ2hhbmdlLCBEaWFnbm9zdGljIH0gZnJvbSAnLi4vbGliL3dvcmtlcnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1vY2tDZGtNb2NrcyB7XG4gIGRlcGxveT86IGplc3QuTW9ja2VkRm48KG9wdGlvbnM6IERlcGxveU9wdGlvbnMpID0+IHZvaWQ+O1xuICB3YXRjaD86IGplc3QuTW9ja2VkRm48KG9wdGlvbnM6IERlcGxveU9wdGlvbnMpID0+IENoaWxkUHJvY2Vzcz47XG4gIHN5bnRoPzogamVzdC5Nb2NrZWRGbjwob3B0aW9uczogU3ludGhPcHRpb25zKSA9PiB2b2lkPjtcbiAgc3ludGhGYXN0PzogamVzdC5Nb2NrZWRGbjwob3B0aW9uczogU3ludGhGYXN0T3B0aW9ucykgPT4gdm9pZD47XG4gIGRlc3Ryb3k/OiBqZXN0Lk1vY2tlZEZuPChvcHRpb25zOiBEZXN0cm95T3B0aW9ucykgPT4gdm9pZD47XG4gIGxpc3Q/OiBqZXN0Lk1vY2tlZEZuPChvcHRpb25zOiBMaXN0T3B0aW9ucykgPT4gc3RyaW5nPjtcbn1cblxuZXhwb3J0IGNsYXNzIE1vY2tDZGtQcm92aWRlciB7XG4gIHB1YmxpYyByZWFkb25seSBjZGs6IElDZGs7XG4gIHB1YmxpYyByZWFkb25seSBtb2NrczogTW9ja0Nka01vY2tzID0ge307XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogQ2RrQ2xpV3JhcHBlck9wdGlvbnMpIHtcbiAgICB0aGlzLmNkayA9IG5ldyBDZGtDbGlXcmFwcGVyKG9wdGlvbnMpO1xuICB9XG5cbiAgcHVibGljIG1vY2tEZXBsb3kobW9jaz86IE1vY2tDZGtNb2Nrc1snZGVwbG95J10pIHtcbiAgICB0aGlzLm1vY2tzLmRlcGxveSA9IG1vY2sgPz8gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICAgIHRoaXMuY2RrLmRlcGxveSA9IHRoaXMubW9ja3MuZGVwbG95O1xuICB9XG4gIHB1YmxpYyBtb2NrV2F0Y2gobW9jaz86IE1vY2tDZGtNb2Nrc1snd2F0Y2gnXSkge1xuICAgIHRoaXMubW9ja3Mud2F0Y2ggPSBtb2NrID8/IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oamVzdC5mbigoKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvbjogKF9ldmVudDogJ2Nsb3NlJywgbGlzdGVuZXI6ICguLi5fYXJnczogYW55W10pID0+IHZvaWQpID0+IHtcbiAgICAgICAgICBsaXN0ZW5lcigwKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3Rkb3V0OiBuZXcgUmVhZGFibGUoeyByZWFkOiBqZXN0LmZuKCgpID0+IHt9KSB9KSxcbiAgICAgICAgc3RkZXJyOiBuZXcgUmVhZGFibGUoeyByZWFkOiBqZXN0LmZuKCgpID0+IHt9KSB9KSxcbiAgICAgICAgc3RkaW46IG5ldyBXcml0YWJsZSh7IHdyaXRlOiBqZXN0LmZuKCgpID0+IHt9KSwgZmluYWw6IGplc3QuZm4oKCkgPT4ge30pIH0pLFxuICAgICAgfSBhcyB1bmtub3duIGFzIENoaWxkUHJvY2VzcztcbiAgICB9KSk7XG4gICAgdGhpcy5jZGsud2F0Y2ggPSB0aGlzLm1vY2tzLndhdGNoO1xuICB9XG4gIHB1YmxpYyBtb2NrU3ludGgobW9jaz86IE1vY2tDZGtNb2Nrc1snc3ludGgnXSkge1xuICAgIHRoaXMubW9ja3Muc3ludGggPSBtb2NrID8/IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICB0aGlzLmNkay5zeW50aCA9IHRoaXMubW9ja3Muc3ludGg7XG4gIH1cbiAgcHVibGljIG1vY2tTeW50aEZhc3QobW9jaz86IE1vY2tDZGtNb2Nrc1snc3ludGhGYXN0J10pIHtcbiAgICB0aGlzLm1vY2tzLnN5bnRoRmFzdCA9IG1vY2sgPz8gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICAgIHRoaXMuY2RrLnN5bnRoRmFzdCA9IHRoaXMubW9ja3Muc3ludGhGYXN0O1xuICB9XG4gIHB1YmxpYyBtb2NrRGVzdHJveShtb2NrPzogTW9ja0Nka01vY2tzWydkZXN0cm95J10pIHtcbiAgICB0aGlzLm1vY2tzLmRlc3Ryb3kgPSBtb2NrID8/IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICB0aGlzLmNkay5kZXN0cm95ID0gdGhpcy5tb2Nrcy5kZXN0cm95O1xuICB9XG4gIHB1YmxpYyBtb2NrTGlzdChtb2NrPzogTW9ja0Nka01vY2tzWydsaXN0J10pIHtcbiAgICB0aGlzLm1vY2tzLmxpc3QgPSBtb2NrID8/IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICB0aGlzLmNkay5saXN0ID0gdGhpcy5tb2Nrcy5saXN0O1xuICB9XG4gIHB1YmxpYyBtb2NrQWxsKG1vY2tzOiBNb2NrQ2RrTW9ja3MgPSB7fSk6IFJlcXVpcmVkPE1vY2tDZGtNb2Nrcz4ge1xuICAgIHRoaXMubW9ja0RlcGxveShtb2Nrcy5kZXBsb3kpO1xuICAgIHRoaXMubW9ja1dhdGNoKG1vY2tzLndhdGNoKTtcbiAgICB0aGlzLm1vY2tTeW50aChtb2Nrcy5zeW50aCk7XG4gICAgdGhpcy5tb2NrU3ludGhGYXN0KG1vY2tzLnN5bnRoRmFzdCk7XG4gICAgdGhpcy5tb2NrRGVzdHJveShtb2Nrcy5kZXN0cm95KTtcbiAgICB0aGlzLm1vY2tMaXN0KG1vY2tzLmxpc3QpO1xuXG4gICAgcmV0dXJuIHRoaXMubW9ja3MgYXMgUmVxdWlyZWQ8TW9ja0Nka01vY2tzPjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW4gYSB0ZXN0IG9mIHRoZSB0ZXN0U25hcHNob3QgbWV0aG9kXG4gICAqIEBwYXJhbSBpbnRlZ1Rlc3RGaWxlIFRoaXMgbmFtZSBpcyB1c2VkIHRvIGRldGVybWluZWQgdGhlIGV4cGVjdGVkIChjb21taXR0ZWQpIHNuYXBzaG90XG4gICAqIEBwYXJhbSBhY3R1YWxTbmFwc2hvdCBUaGUgZGlyZWN0b3J5IG9mIHRoZSBzbmFwc2hvdCB0aGF0IGlzIHVzZWQgZm9yIG9mIHRoZSBhY3R1YWwgKGN1cnJlbnQpIGFwcFxuICAgKiBAcmV0dXJucyBEaWFnbm9zdGljcyBhcyB0aGV5IHdvdWxkIGJlIHJldHVybmVkIGJ5IHRlc3RTbmFwc2hvdFxuICAgKi9cbiAgcHVibGljIHNuYXBzaG90VGVzdChpbnRlZ1Rlc3RGaWxlOiBzdHJpbmcsIGFjdHVhbFNuYXBzaG90Pzogc3RyaW5nKToge1xuICAgIGRpYWdub3N0aWNzOiBEaWFnbm9zdGljW107XG4gICAgZGVzdHJ1Y3RpdmVDaGFuZ2VzOiBEZXN0cnVjdGl2ZUNoYW5nZVtdO1xuICB9IHtcbiAgICAvLyBXSEVOXG4gICAgY29uc3QgaW50ZWdUZXN0ID0gbmV3IEludGVnU25hcHNob3RSdW5uZXIoe1xuICAgICAgY2RrOiB0aGlzLmNkayxcbiAgICAgIHRlc3Q6IG5ldyBJbnRlZ1Rlc3Qoe1xuICAgICAgICBmaWxlTmFtZTogJ3Rlc3QvdGVzdC1kYXRhLycgKyBpbnRlZ1Rlc3RGaWxlLFxuICAgICAgICBkaXNjb3ZlcnlSb290OiAndGVzdC90ZXN0LWRhdGEnLFxuICAgICAgfSksXG4gICAgICBpbnRlZ091dERpcjogYWN0dWFsU25hcHNob3QgPyAndGVzdC90ZXN0LWRhdGEvJyArIGFjdHVhbFNuYXBzaG90IDogdW5kZWZpbmVkLFxuICAgIH0pO1xuICAgIGludGVnVGVzdC5hY3R1YWxUZXN0cygpO1xuICAgIGNvbnN0IHJlc3VsdHMgPSBpbnRlZ1Rlc3QudGVzdFNuYXBzaG90KCk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHRoaXMubW9ja3Muc3ludGhGYXN0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgZXhwZWN0KHRoaXMubW9ja3Muc3ludGhGYXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICBlbnY6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgQ0RLX0lOVEVHX0FDQ09VTlQ6ICcxMjM0NTY3OCcsXG4gICAgICAgIENES19JTlRFR19SRUdJT046ICd0ZXN0LXJlZ2lvbicsXG4gICAgICB9KSxcbiAgICAgIGV4ZWNDbWQ6IFsnbm9kZScsIGludGVnVGVzdEZpbGVdLFxuICAgICAgb3V0cHV0OiBhY3R1YWxTbmFwc2hvdCA/PyBgY2RrLWludGVnLm91dC4ke2ludGVnVGVzdEZpbGV9LnNuYXBzaG90YCxcbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG59XG4iXX0=