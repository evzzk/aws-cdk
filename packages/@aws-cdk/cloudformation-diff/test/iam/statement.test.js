"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fc = require("fast-check");
const statement_1 = require("../../lib/iam/statement");
const test_arbitraries_1 = require("../test-arbitraries");
test('can parse all positive fields', () => {
    const statement = new statement_1.Statement({
        Sid: 'Sid',
        Effect: 'Allow',
        Resource: ['resource'],
        Action: ['action'],
        Principal: [{ AWS: 'arn' }],
        Condition: { StringEquals: { 'Amzn-This': 'That' } },
    });
    expect(statement.sid).toEqual('Sid');
    expect(statement.effect).toEqual('Allow');
    expect(statement.resources.values).toEqual(['resource']);
    expect(statement.actions.values).toEqual(['action']);
    expect(statement.principals.values).toEqual(['AWS:arn']);
    expect(statement.condition).toEqual({ StringEquals: { 'Amzn-This': 'That' } });
    expect(statement.resources.not).toBe(false);
    expect(statement.actions.not).toBe(false);
    expect(statement.principals.not).toBe(false);
});
test('parses strings as singleton lists', () => {
    const statement = new statement_1.Statement({
        Resource: 'resource',
    });
    expect(statement.resources.values).toEqual(['resource']);
});
test('correctly parses NotFields', () => {
    const statement = new statement_1.Statement({
        NotResource: ['resource'],
        NotAction: ['action'],
        NotPrincipal: [{ AWS: 'arn' }],
    });
    expect(statement.resources.not).toBe(true);
    expect(statement.actions.not).toBe(true);
    expect(statement.principals.not).toBe(true);
});
test('parse all LambdaPermission fields', () => {
    const statement = (0, statement_1.parseLambdaPermission)({
        Action: 'lambda:CallMeMaybe',
        FunctionName: 'Function',
        Principal: '*',
        SourceAccount: '123456789012',
        SourceArn: 'arn',
    });
    expect(statement.actions.values).toEqual(['lambda:CallMeMaybe']);
    expect(statement.resources.values).toEqual(['Function']);
    expect(statement.principals.values).toEqual(['*']);
    expect(statement.condition).toEqual({
        ArnLike: { 'AWS:SourceArn': 'arn' },
        StringEquals: { 'AWS:SourceAccount': '123456789012' },
    });
});
test('parse lambda eventsourcetoken', () => {
    const statement = (0, statement_1.parseLambdaPermission)({
        Action: 'lambda:CallMeMaybe',
        FunctionName: 'Function',
        EventSourceToken: 'token',
        Principal: '*',
    });
    expect(statement.condition).toEqual({
        StringEquals: { 'lambda:EventSourceToken': 'token' },
    });
});
test('stringify complex condition', () => {
    // WHEN
    const stringified = (0, statement_1.renderCondition)({
        StringEquals: { 'AWS:SourceAccount': '${AWS::AccountId}' },
        ArnLike: { 'AWS:SourceArn': '${MyBucket.Arn}' },
    }).split('\n');
    // THEN
    expect(stringified).toEqual([
        '"StringEquals": {',
        '  "AWS:SourceAccount": "${AWS::AccountId}"',
        '},',
        '"ArnLike": {',
        '  "AWS:SourceArn": "${MyBucket.Arn}"',
        '}',
    ]);
});
test('an Allow statement with a NotPrincipal is negative', () => {
    // WHEN
    const statement = new statement_1.Statement({
        Effect: 'Allow',
        Resource: 'resource',
        NotPrincipal: { AWS: 'me' },
    });
    // THEN
    expect(statement.isNegativeStatement).toBe(true);
});
test('a Deny statement with a NotPrincipal is positive', () => {
    // In effect, this is a roundabout way of saying only the given Principal
    // should be allowed ("everyone who's not me can't do this").
    // WHEN
    const statement = new statement_1.Statement({
        Effect: 'Deny',
        Resource: 'resource',
        NotPrincipal: { AWS: 'me' },
    });
    // THEN
    expect(statement.isNegativeStatement).toBe(false);
});
test('equality is reflexive', () => {
    fc.assert(fc.property(test_arbitraries_1.arbitraryStatement, (statement) => {
        return new statement_1.Statement(statement).equal(new statement_1.Statement(statement));
    }));
});
test('equality is symmetric', () => {
    fc.assert(fc.property(test_arbitraries_1.twoArbitraryStatements, (s) => {
        const a = new statement_1.Statement(s.statement1);
        const b = new statement_1.Statement(s.statement2);
        fc.pre(a.equal(b));
        return b.equal(a);
    }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGVtZW50LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzdGF0ZW1lbnQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUFpQztBQUNqQyx1REFBNEY7QUFDNUYsMERBQWlGO0FBRWpGLElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7SUFDekMsTUFBTSxTQUFTLEdBQUcsSUFBSSxxQkFBUyxDQUFDO1FBQzlCLEdBQUcsRUFBRSxLQUFLO1FBQ1YsTUFBTSxFQUFFLE9BQU87UUFDZixRQUFRLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFDdEIsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDO1FBQ2xCLFNBQVMsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQzNCLFNBQVMsRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRTtLQUNyRCxDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMxQyxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ3pELE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDckQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN6RCxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFF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O1FBQ3BCLFlBQVksRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUU7S0FDNUIsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sQ0FBQyxTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FDbkIscUNBQWtCLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRTtRQUNoQyxPQUFPLElBQUkscUJBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxxQkFBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDbEUsQ0FBQyxDQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtJQUNqQyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQ25CLHlDQUFzQixFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDNUIsTUFBTSxDQUFDLEdBQUcsSUFBSSxxQkFBUyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0QyxNQUFNLENBQUMsR0FBRyxJQUFJLHFCQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXRDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25CLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQixDQUFDLENBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBmYyBmcm9tICdmYXN0LWNoZWNrJztcbmltcG9ydCB7IHBhcnNlTGFtYmRhUGVybWlzc2lvbiwgcmVuZGVyQ29uZGl0aW9uLCBTdGF0ZW1lbnQgfSBmcm9tICcuLi8uLi9saWIvaWFtL3N0YXRlbWVudCc7XG5pbXBvcnQgeyBhcmJpdHJhcnlTdGF0ZW1lbnQsIHR3b0FyYml0cmFyeVN0YXRlbWVudHMgfSBmcm9tICcuLi90ZXN0LWFyYml0cmFyaWVzJztcblxudGVzdCgnY2FuIHBhcnNlIGFsbCBwb3NpdGl2ZSBmaWVsZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IG5ldyBTdGF0ZW1lbnQoe1xuICAgIFNpZDogJ1NpZCcsXG4gICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgIFJlc291cmNlOiBbJ3Jlc291cmNlJ10sXG4gICAgQWN0aW9uOiBbJ2FjdGlvbiddLFxuICAgIFByaW5jaXBhbDogW3sgQVdTOiAnYXJuJyB9XSxcbiAgICBDb25kaXRpb246IHsgU3RyaW5nRXF1YWxzOiB7ICdBbXpuLVRoaXMnOiAnVGhhdCcgfSB9LFxuICB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LnNpZCkudG9FcXVhbCgnU2lkJyk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuZWZmZWN0KS50b0VxdWFsKCdBbGxvdycpO1xuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy52YWx1ZXMpLnRvRXF1YWwoWydyZXNvdXJjZSddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5hY3Rpb25zLnZhbHVlcykudG9FcXVhbChbJ2FjdGlvbiddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLnZhbHVlcykudG9FcXVhbChbJ0FXUzphcm4nXSk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuY29uZGl0aW9uKS50b0VxdWFsKHsgU3RyaW5nRXF1YWxzOiB7ICdBbXpuLVRoaXMnOiAnVGhhdCcgfSB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy5ub3QpLnRvQmUoZmFsc2UpO1xuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMubm90KS50b0JlKGZhbHNlKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLm5vdCkudG9CZShmYWxzZSk7XG59KTtcblxudGVzdCgncGFyc2VzIHN0cmluZ3MgYXMgc2luZ2xldG9uIGxpc3RzJywgKCkgPT4ge1xuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBSZXNvdXJjZTogJ3Jlc291cmNlJyxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5yZXNvdXJjZXMudmFsdWVzKS50b0VxdWFsKFsncmVzb3VyY2UnXSk7XG59KTtcblxudGVzdCgnY29ycmVjdGx5IHBhcnNlcyBOb3RGaWVsZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IG5ldyBTdGF0ZW1lbnQoe1xuICAgIE5vdFJlc291cmNlOiBbJ3Jlc291cmNlJ10sXG4gICAgTm90QWN0aW9uOiBbJ2FjdGlvbiddLFxuICAgIE5vdFByaW5jaXBhbDogW3sgQVdTOiAnYXJuJyB9XSxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5yZXNvdXJjZXMubm90KS50b0JlKHRydWUpO1xuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMubm90KS50b0JlKHRydWUpO1xuICBleHBlY3Qoc3RhdGVtZW50LnByaW5jaXBhbHMubm90KS50b0JlKHRydWUpO1xufSk7XG5cbnRlc3QoJ3BhcnNlIGFsbCBMYW1iZGFQZXJtaXNzaW9uIGZpZWxkcycsICgpID0+IHtcbiAgY29uc3Qgc3RhdGVtZW50ID0gcGFyc2VMYW1iZGFQZXJtaXNzaW9uKHtcbiAgICBBY3Rpb246ICdsYW1iZGE6Q2FsbE1lTWF5YmUnLFxuICAgIEZ1bmN0aW9uTmFtZTogJ0Z1bmN0aW9uJyxcbiAgICBQcmluY2lwYWw6ICcqJyxcbiAgICBTb3VyY2VBY2NvdW50OiAnMTIzNDU2Nzg5MDEyJyxcbiAgICBTb3VyY2VBcm46ICdhcm4nLFxuICB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMudmFsdWVzKS50b0VxdWFsKFsnbGFtYmRhOkNhbGxNZU1heWJlJ10pO1xuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy52YWx1ZXMpLnRvRXF1YWwoWydGdW5jdGlvbiddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLnZhbHVlcykudG9FcXVhbChbJyonXSk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuY29uZGl0aW9uKS50b0VxdWFsKHtcbiAgICBBcm5MaWtlOiB7ICdBV1M6U291cmNlQXJuJzogJ2FybicgfSxcbiAgICBTdHJpbmdFcXVhbHM6IHsgJ0FXUzpTb3VyY2VBY2NvdW50JzogJzEyMzQ1Njc4OTAxMicgfSxcbiAgfSk7XG59KTtcblxudGVzdCgncGFyc2UgbGFtYmRhIGV2ZW50c291cmNldG9rZW4nLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IHBhcnNlTGFtYmRhUGVybWlzc2lvbih7XG4gICAgQWN0aW9uOiAnbGFtYmRhOkNhbGxNZU1heWJlJyxcbiAgICBGdW5jdGlvbk5hbWU6ICdGdW5jdGlvbicsXG4gICAgRXZlbnRTb3VyY2VUb2tlbjogJ3Rva2VuJyxcbiAgICBQcmluY2lwYWw6ICcqJyxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5jb25kaXRpb24pLnRvRXF1YWwoe1xuICAgIFN0cmluZ0VxdWFsczogeyAnbGFtYmRhOkV2ZW50U291cmNlVG9rZW4nOiAndG9rZW4nIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3N0cmluZ2lmeSBjb21wbGV4IGNvbmRpdGlvbicsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBzdHJpbmdpZmllZCA9IHJlbmRlckNvbmRpdGlvbih7XG4gICAgU3RyaW5nRXF1YWxzOiB7ICdBV1M6U291cmNlQWNjb3VudCc6ICcke0FXUzo6QWNjb3VudElkfScgfSxcbiAgICBBcm5MaWtlOiB7ICdBV1M6U291cmNlQXJuJzogJyR7TXlCdWNrZXQuQXJufScgfSxcbiAgfSkuc3BsaXQoJ1xcbicpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0cmluZ2lmaWVkKS50b0VxdWFsKFtcbiAgICAnXCJTdHJpbmdFcXVhbHNcIjogeycsXG4gICAgJyAgXCJBV1M6U291cmNlQWNjb3VudFwiOiBcIiR7QVdTOjpBY2NvdW50SWR9XCInLFxuICAgICd9LCcsXG4gICAgJ1wiQXJuTGlrZVwiOiB7JyxcbiAgICAnICBcIkFXUzpTb3VyY2VBcm5cIjogXCIke015QnVja2V0LkFybn1cIicsXG4gICAgJ30nLFxuICBdKTtcbn0pO1xuXG50ZXN0KCdhbiBBbGxvdyBzdGF0ZW1lbnQgd2l0aCBhIE5vdFByaW5jaXBhbCBpcyBuZWdhdGl2ZScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgUmVzb3VyY2U6ICdyZXNvdXJjZScsXG4gICAgTm90UHJpbmNpcGFsOiB7IEFXUzogJ21lJyB9LFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGF0ZW1lbnQuaXNOZWdhdGl2ZVN0YXRlbWVudCkudG9CZSh0cnVlKTtcbn0pO1xuXG50ZXN0KCdhIERlbnkgc3RhdGVtZW50IHdpdGggYSBOb3RQcmluY2lwYWwgaXMgcG9zaXRpdmUnLCAoKSA9PiB7XG4gIC8vIEluIGVmZmVjdCwgdGhpcyBpcyBhIHJvdW5kYWJvdXQgd2F5IG9mIHNheWluZyBvbmx5IHRoZSBnaXZlbiBQcmluY2lwYWxcbiAgLy8gc2hvdWxkIGJlIGFsbG93ZWQgKFwiZXZlcnlvbmUgd2hvJ3Mgbm90IG1lIGNhbid0IGRvIHRoaXNcIikuXG5cbiAgLy8gV0hFTlxuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBFZmZlY3Q6ICdEZW55JyxcbiAgICBSZXNvdXJjZTogJ3Jlc291cmNlJyxcbiAgICBOb3RQcmluY2lwYWw6IHsgQVdTOiAnbWUnIH0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YXRlbWVudC5pc05lZ2F0aXZlU3RhdGVtZW50KS50b0JlKGZhbHNlKTtcbn0pO1xuXG50ZXN0KCdlcXVhbGl0eSBpcyByZWZsZXhpdmUnLCAoKSA9PiB7XG4gIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICBhcmJpdHJhcnlTdGF0ZW1lbnQsIChzdGF0ZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiBuZXcgU3RhdGVtZW50KHN0YXRlbWVudCkuZXF1YWwobmV3IFN0YXRlbWVudChzdGF0ZW1lbnQpKTtcbiAgICB9LFxuICApKTtcbn0pO1xuXG50ZXN0KCdlcXVhbGl0eSBpcyBzeW1tZXRyaWMnLCAoKSA9PiB7XG4gIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICB0d29BcmJpdHJhcnlTdGF0ZW1lbnRzLCAocykgPT4ge1xuICAgICAgY29uc3QgYSA9IG5ldyBTdGF0ZW1lbnQocy5zdGF0ZW1lbnQxKTtcbiAgICAgIGNvbnN0IGIgPSBuZXcgU3RhdGVtZW50KHMuc3RhdGVtZW50Mik7XG5cbiAgICAgIGZjLnByZShhLmVxdWFsKGIpKTtcbiAgICAgIHJldHVybiBiLmVxdWFsKGEpO1xuICAgIH0sXG4gICkpO1xufSk7XG4iXX0=