"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fc = require("fast-check");
const security_group_rule_1 = require("../../lib/network/security-group-rule");
const test_arbitraries_1 = require("../test-arbitraries");
test('can parse cidr-ip', () => {
    const rule = new security_group_rule_1.SecurityGroupRule({
        GroupId: 'sg-1234',
        IpProtocol: 'tcp',
        FromPort: 10,
        ToPort: 20,
        CidrIp: '1.2.3.4/8',
    });
    expect(rule.groupId).toEqual('sg-1234');
    expect(rule.ipProtocol).toEqual('tcp');
    expect(rule.fromPort).toEqual(10);
    expect(rule.toPort).toEqual(20);
    const peer = rule.peer;
    if (peer.kind !== 'cidr-ip') {
        throw new Error('Fail');
    }
    expect(peer.ip).toEqual('1.2.3.4/8');
});
test('can parse cidr-ip 6', () => {
    const rule = new security_group_rule_1.SecurityGroupRule({
        CidrIpv6: '::/0',
    });
    const peer = rule.peer;
    if (peer.kind !== 'cidr-ip') {
        throw new Error('Fail');
    }
    expect(peer.ip).toEqual('::/0');
});
test('can parse securityGroup', () => {
    for (const key of ['DestinationSecurityGroupId', 'SourceSecurityGroupId']) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            [key]: 'sg-1234',
        });
        const peer = rule.peer;
        if (peer.kind !== 'security-group') {
            throw new Error('Fail');
        }
        expect(peer.securityGroupId).toEqual('sg-1234');
    }
});
test('can parse prefixlist', () => {
    for (const key of ['DestinationPrefixListId', 'SourcePrefixListId']) {
        const rule = new security_group_rule_1.SecurityGroupRule({
            [key]: 'pl-1',
        });
        const peer = rule.peer;
        if (peer.kind !== 'prefix-list') {
            throw new Error('Fail');
        }
        expect(peer.prefixListId).toEqual('pl-1');
    }
});
test('equality is reflexive', () => {
    fc.assert(fc.property(test_arbitraries_1.arbitraryRule, (statement) => {
        return new security_group_rule_1.SecurityGroupRule(statement).equal(new security_group_rule_1.SecurityGroupRule(statement));
    }));
});
test('equality is symmetric', () => {
    fc.assert(fc.property(test_arbitraries_1.twoArbitraryRules, (s) => {
        const a = new security_group_rule_1.SecurityGroupRule(s.rule1);
        const b = new security_group_rule_1.SecurityGroupRule(s.rule2);
        fc.pre(a.equal(b));
        return b.equal(a);
    }));
});
test('can describe protocol', () => {
    expect(new security_group_rule_1.SecurityGroupRule({ IpProtocol: -1 }).describeProtocol()).toEqual('Everything');
    expect(new security_group_rule_1.SecurityGroupRule({ IpProtocol: '-1' }).describeProtocol()).toEqual('Everything');
    expect(new security_group_rule_1.SecurityGroupRule({ FromPort: -1 }).describeProtocol()).toEqual('All *UNKNOWN*');
    expect(new security_group_rule_1.SecurityGroupRule({ IpProtocol: 'tcp', FromPort: -1, ToPort: -1 }).describeProtocol()).toEqual('All TCP');
    expect(new security_group_rule_1.SecurityGroupRule({ IpProtocol: 'tcp', FromPort: 10, ToPort: 20 }).describeProtocol()).toEqual('TCP 10-20');
    expect(new security_group_rule_1.SecurityGroupRule({ IpProtocol: 'tcp', FromPort: 10, ToPort: 10 }).describeProtocol()).toEqual('TCP 10');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVsZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicnVsZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaUNBQWlDO0FBQ2pDLCtFQUEwRTtBQUMxRSwwREFBdUU7QUFFdkUsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUM3QixNQUFNLElBQUksR0FBRyxJQUFJLHVDQUFpQixDQUFDO1FBQ2pDLE9BQU8sRUFBRSxTQUFTO1FBQ2xCLFVBQVUsRUFBRSxLQUFLO1FBQ2pCLFFBQVEsRUFBRSxFQUFFO1FBQ1osTUFBTSxFQUFFLEVBQUU7UUFDVixNQUFNLEVBQUUsV0FBVztLQUNwQixDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVoQyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSyxDQUFDO0lBQ3hCLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQ3pELE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUMvQixNQUFNLElBQUksR0FBRyxJQUFJLHVDQUFpQixDQUFDO1FB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eyBTZWN1cml0eUdyb3VwUnVsZSB9IGZyb20gJy4uLy4uL2xpYi9uZXR3b3JrL3NlY3VyaXR5LWdyb3VwLXJ1bGUnO1xuaW1wb3J0IHsgYXJiaXRyYXJ5UnVsZSwgdHdvQXJiaXRyYXJ5UnVsZXMgfSBmcm9tICcuLi90ZXN0LWFyYml0cmFyaWVzJztcblxudGVzdCgnY2FuIHBhcnNlIGNpZHItaXAnLCAoKSA9PiB7XG4gIGNvbnN0IHJ1bGUgPSBuZXcgU2VjdXJpdHlHcm91cFJ1bGUoe1xuICAgIEdyb3VwSWQ6ICdzZy0xMjM0JyxcbiAgICBJcFByb3RvY29sOiAndGNwJyxcbiAgICBGcm9tUG9ydDogMTAsXG4gICAgVG9Qb3J0OiAyMCxcbiAgICBDaWRySXA6ICcxLjIuMy40LzgnLFxuICB9KTtcblxuICBleHBlY3QocnVsZS5ncm91cElkKS50b0VxdWFsKCdzZy0xMjM0Jyk7XG4gIGV4cGVjdChydWxlLmlwUHJvdG9jb2wpLnRvRXF1YWwoJ3RjcCcpO1xuICBleHBlY3QocnVsZS5mcm9tUG9ydCkudG9FcXVhbCgxMCk7XG4gIGV4cGVjdChydWxlLnRvUG9ydCkudG9FcXVhbCgyMCk7XG5cbiAgY29uc3QgcGVlciA9IHJ1bGUucGVlciE7XG4gIGlmIChwZWVyLmtpbmQgIT09ICdjaWRyLWlwJykgeyB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWwnKTsgfVxuICBleHBlY3QocGVlci5pcCkudG9FcXVhbCgnMS4yLjMuNC84Jyk7XG59KTtcblxudGVzdCgnY2FuIHBhcnNlIGNpZHItaXAgNicsICgpID0+IHtcbiAgY29uc3QgcnVsZSA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7XG4gICAgQ2lkcklwdjY6ICc6Oi8wJyxcbiAgfSk7XG5cbiAgY29uc3QgcGVlciA9IHJ1bGUucGVlciE7XG4gIGlmIChwZWVyLmtpbmQgIT09ICdjaWRyLWlwJykgeyB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWwnKTsgfVxuICBleHBlY3QocGVlci5pcCkudG9FcXVhbCgnOjovMCcpO1xufSk7XG5cbnRlc3QoJ2NhbiBwYXJzZSBzZWN1cml0eUdyb3VwJywgKCkgPT4ge1xuICBmb3IgKGNvbnN0IGtleSBvZiBbJ0Rlc3RpbmF0aW9uU2VjdXJpdHlHcm91cElkJywgJ1NvdXJjZVNlY3VyaXR5R3JvdXBJZCddKSB7XG4gICAgY29uc3QgcnVsZSA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7XG4gICAgICBba2V5XTogJ3NnLTEyMzQnLFxuICAgIH0pO1xuXG4gICAgY29uc3QgcGVlciA9IHJ1bGUucGVlciE7XG4gICAgaWYgKHBlZXIua2luZCAhPT0gJ3NlY3VyaXR5LWdyb3VwJykgeyB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWwnKTsgfVxuICAgIGV4cGVjdChwZWVyLnNlY3VyaXR5R3JvdXBJZCkudG9FcXVhbCgnc2ctMTIzNCcpO1xuICB9XG59KTtcblxudGVzdCgnY2FuIHBhcnNlIHByZWZpeGxpc3QnLCAoKSA9PiB7XG4gIGZvciAoY29uc3Qga2V5IG9mIFsnRGVzdGluYXRpb25QcmVmaXhMaXN0SWQnLCAnU291cmNlUHJlZml4TGlzdElkJ10pIHtcbiAgICBjb25zdCBydWxlID0gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHtcbiAgICAgIFtrZXldOiAncGwtMScsXG4gICAgfSk7XG5cbiAgICBjb25zdCBwZWVyID0gcnVsZS5wZWVyITtcbiAgICBpZiAocGVlci5raW5kICE9PSAncHJlZml4LWxpc3QnKSB7IHRocm93IG5ldyBFcnJvcignRmFpbCcpOyB9XG4gICAgZXhwZWN0KHBlZXIucHJlZml4TGlzdElkKS50b0VxdWFsKCdwbC0xJyk7XG4gIH1cbn0pO1xuXG50ZXN0KCdlcXVhbGl0eSBpcyByZWZsZXhpdmUnLCAoKSA9PiB7XG4gIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICBhcmJpdHJhcnlSdWxlLCAoc3RhdGVtZW50KSA9PiB7XG4gICAgICByZXR1cm4gbmV3IFNlY3VyaXR5R3JvdXBSdWxlKHN0YXRlbWVudCkuZXF1YWwobmV3IFNlY3VyaXR5R3JvdXBSdWxlKHN0YXRlbWVudCkpO1xuICAgIH0sXG4gICkpO1xufSk7XG5cbnRlc3QoJ2VxdWFsaXR5IGlzIHN5bW1ldHJpYycsICgpID0+IHtcbiAgZmMuYXNzZXJ0KGZjLnByb3BlcnR5KFxuICAgIHR3b0FyYml0cmFyeVJ1bGVzLCAocykgPT4ge1xuICAgICAgY29uc3QgYSA9IG5ldyBTZWN1cml0eUdyb3VwUnVsZShzLnJ1bGUxKTtcbiAgICAgIGNvbnN0IGIgPSBuZXcgU2VjdXJpdHlHcm91cFJ1bGUocy5ydWxlMik7XG5cbiAgICAgIGZjLnByZShhLmVxdWFsKGIpKTtcbiAgICAgIHJldHVybiBiLmVxdWFsKGEpO1xuICAgIH0sXG4gICkpO1xufSk7XG5cbnRlc3QoJ2NhbiBkZXNjcmliZSBwcm90b2NvbCcsICgpID0+IHtcbiAgZXhwZWN0KG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7IElwUHJvdG9jb2w6IC0xIH0pLmRlc2NyaWJlUHJvdG9jb2woKSkudG9FcXVhbCgnRXZlcnl0aGluZycpO1xuICBleHBlY3QobmV3IFNlY3VyaXR5R3JvdXBSdWxlKHsgSXBQcm90b2NvbDogJy0xJyB9KS5kZXNjcmliZVByb3RvY29sKCkpLnRvRXF1YWwoJ0V2ZXJ5dGhpbmcnKTtcbiAgZXhwZWN0KG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7IEZyb21Qb3J0OiAtMSB9KS5kZXNjcmliZVByb3RvY29sKCkpLnRvRXF1YWwoJ0FsbCAqVU5LTk9XTionKTtcbiAgZXhwZWN0KG5ldyBTZWN1cml0eUdyb3VwUnVsZSh7IElwUHJvdG9jb2w6ICd0Y3AnLCBGcm9tUG9ydDogLTEsIFRvUG9ydDogLTEgfSkuZGVzY3JpYmVQcm90b2NvbCgpKS50b0VxdWFsKCdBbGwgVENQJyk7XG4gIGV4cGVjdChuZXcgU2VjdXJpdHlHcm91cFJ1bGUoeyBJcFByb3RvY29sOiAndGNwJywgRnJvbVBvcnQ6IDEwLCBUb1BvcnQ6IDIwIH0pLmRlc2NyaWJlUHJvdG9jb2woKSkudG9FcXVhbCgnVENQIDEwLTIwJyk7XG4gIGV4cGVjdChuZXcgU2VjdXJpdHlHcm91cFJ1bGUoeyBJcFByb3RvY29sOiAndGNwJywgRnJvbVBvcnQ6IDEwLCBUb1BvcnQ6IDEwIH0pLmRlc2NyaWJlUHJvdG9jb2woKSkudG9FcXVhbCgnVENQIDEwJyk7XG59KTtcbiJdfQ==