"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const wait = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
const DEFAULT_INTERVAL = 1000;
const DEFAULT_MAX_ATTEMPTS = 10;
/**
 * Runs a function on an interval until the maximum number of attempts has
 * been reached.
 *
 * Default interval = 1000 milliseconds
 * Default maxAttempts = 10
 *
 * @param fn function to run
 * @param options EventuallyOptions
 */
const eventually = async (call, options) => {
    const opts = {
        interval: options?.interval ? options.interval : DEFAULT_INTERVAL,
        maxAttempts: options?.maxAttempts ? options.maxAttempts : DEFAULT_MAX_ATTEMPTS,
    };
    while (opts.maxAttempts-- >= 0) {
        try {
            return await call();
        }
        catch (err) {
            if (opts.maxAttempts <= 0)
                throw err;
        }
        await wait(opts.interval);
    }
    throw new Error('An unexpected error has occurred.');
};
exports.default = eventually;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnR1YWxseS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV2ZW50dWFsbHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFTQSxNQUFNLElBQUksR0FBRyxDQUFDLEVBQVUsRUFBaUIsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDOUYsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7QUFDOUIsTUFBTSxvQkFBb0IsR0FBRyxFQUFFLENBQUM7QUFFaEM7Ozs7Ozs7OztHQVNHO0FBQ0gsTUFBTSxVQUFVLEdBQUcsS0FBSyxFQUFLLElBQXNCLEVBQUUsT0FBMkIsRUFBYyxFQUFFO0lBQzlGLE1BQU0sSUFBSSxHQUFHO1FBQ1gsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGdCQUFnQjtRQUNqRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsb0JBQW9CO0tBQy9FLENBQUM7SUFFRixPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQixJQUFJLENBQUM7WUFDSCxPQUFPLE1BQU0sSUFBSSxFQUFFLENBQUM7UUFDdEIsQ0FBQztRQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDYixJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQztnQkFBRSxNQUFNLEdBQUcsQ0FBQztRQUN2QyxDQUFDO1FBQ0QsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7QUFDdkQsQ0FBQyxDQUFDO0FBRUYsa0JBQWUsVUFBVSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAcGFyYW0gbWF4QXR0ZW1wdHMgdGhlIG1heGltdW0gbnVtYmVyIG9mIGF0dGVtcHRzXG4gKiBAcGFyYW0gaW50ZXJ2YWwgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzIHRvIG9ic2VydmUgYmV0d2VlbiBhdHRlbXB0c1xuICovXG5leHBvcnQgdHlwZSBFdmVudHVhbGx5T3B0aW9ucyA9IHtcbiAgbWF4QXR0ZW1wdHM/OiBudW1iZXI7XG4gIGludGVydmFsPzogbnVtYmVyO1xufTtcblxuY29uc3Qgd2FpdCA9IChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuY29uc3QgREVGQVVMVF9JTlRFUlZBTCA9IDEwMDA7XG5jb25zdCBERUZBVUxUX01BWF9BVFRFTVBUUyA9IDEwO1xuXG4vKipcbiAqIFJ1bnMgYSBmdW5jdGlvbiBvbiBhbiBpbnRlcnZhbCB1bnRpbCB0aGUgbWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHMgaGFzXG4gKiBiZWVuIHJlYWNoZWQuXG4gKlxuICogRGVmYXVsdCBpbnRlcnZhbCA9IDEwMDAgbWlsbGlzZWNvbmRzXG4gKiBEZWZhdWx0IG1heEF0dGVtcHRzID0gMTBcbiAqXG4gKiBAcGFyYW0gZm4gZnVuY3Rpb24gdG8gcnVuXG4gKiBAcGFyYW0gb3B0aW9ucyBFdmVudHVhbGx5T3B0aW9uc1xuICovXG5jb25zdCBldmVudHVhbGx5ID0gYXN5bmMgPFQ+KGNhbGw6ICgpID0+IFByb21pc2U8VD4sIG9wdGlvbnM/OiBFdmVudHVhbGx5T3B0aW9ucyk6IFByb21pc2U8VD4gPT4ge1xuICBjb25zdCBvcHRzID0ge1xuICAgIGludGVydmFsOiBvcHRpb25zPy5pbnRlcnZhbCA/IG9wdGlvbnMuaW50ZXJ2YWwgOiBERUZBVUxUX0lOVEVSVkFMLFxuICAgIG1heEF0dGVtcHRzOiBvcHRpb25zPy5tYXhBdHRlbXB0cyA/IG9wdGlvbnMubWF4QXR0ZW1wdHMgOiBERUZBVUxUX01BWF9BVFRFTVBUUyxcbiAgfTtcblxuICB3aGlsZSAob3B0cy5tYXhBdHRlbXB0cy0tID49IDApIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGNhbGwoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChvcHRzLm1heEF0dGVtcHRzIDw9IDApIHRocm93IGVycjtcbiAgICB9XG4gICAgYXdhaXQgd2FpdChvcHRzLmludGVydmFsKTtcbiAgfVxuXG4gIHRocm93IG5ldyBFcnJvcignQW4gdW5leHBlY3RlZCBlcnJvciBoYXMgb2NjdXJyZWQuJyk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBldmVudHVhbGx5O1xuIl19